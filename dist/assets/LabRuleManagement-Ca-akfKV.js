import{u as I,e as O,m as F,f as T,r,a2 as l,a3 as o,a0 as u,j as s}from"./index-B-QOVXil.js";import{M as U}from"./MarkdownRenderer-DbuJuX1V.js";import{n as D,o as $}from"./App-gCA-TVeX.js";const B=()=>{const{currentUser:n,isFacilityStaff:g}=I(),{t,isJapanese:c}=O(),{labRules:h}=F(),{showToast:y}=T(),{acknowledgeRule:w}=D(),[i,N]=r.useState("ALL"),[d,k]=r.useState("ALL"),[x,C]=r.useState(!1),[j,v]=r.useState(null),R={[l.GeneralConduct]:{jp:"一般的な行動規範",en:"General Conduct"},[l.SafetyRules]:{jp:"安全規則",en:"Safety Rules"},[l.EquipmentUsage]:{jp:"機器使用ルール",en:"Equipment Usage"},[l.ChemicalHandling]:{jp:"薬品取り扱い",en:"Chemical Handling"},[l.WasteDisposal]:{jp:"廃棄物処理",en:"Waste Disposal"},[l.AccessControl]:{jp:"入退室管理",en:"Access Control"},[l.DataSecurity]:{jp:"データセキュリティ",en:"Data Security"},[l.Cleanliness]:{jp:"清潔維持",en:"Cleanliness"},[l.Parking]:{jp:"駐車場利用",en:"Parking"},[l.CommonArea]:{jp:"共用エリア",en:"Common Area"},[l.Other]:{jp:"その他",en:"Other"}},f={[o.Mandatory]:{key:"importanceMandatory",color:"bg-red-100 text-red-800"},[o.Recommended]:{key:"importanceRecommended",color:"bg-yellow-100 text-yellow-800"},[o.Optional]:{key:"importanceOptional",color:"bg-blue-100 text-blue-800"}},m=r.useMemo(()=>n?h.filter(e=>{var a;switch(e.targetAudience){case u.AllUsers:return!0;case u.Tenants:return n.roleCategory==="TENANT";case u.FacilityStaff:return n.roleCategory==="FACILITY";case u.SpecificRoles:return((a=e.specificRoles)==null?void 0:a.includes(n.role))??!1;default:return g}}):[],[h,n,g]),p=r.useMemo(()=>m.filter(e=>e.importance===o.Mandatory&&!e.acknowledgedBy.some(a=>a.userId===(n==null?void 0:n.id))),[m,n]),A=r.useMemo(()=>m.filter(e=>!(i!=="ALL"&&e.category!==i||d!=="ALL"&&e.importance!==d||x&&!p.some(a=>a.id===e.id))).sort((e,a)=>e.ruleNumber.localeCompare(a.ruleNumber)),[m,i,d,x,p]),L=async e=>{const a=await w(e);a.success===!1&&y(`${t("ackFailed")}: ${a.error.message}`,"error")},M=e=>{v(a=>a===e?null:e)};return n?s.jsxs("div",{className:"p-6",children:[s.jsx("h2",{className:"text-2xl font-bold mb-4",children:t("labRules")}),p.length>0&&s.jsxs("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6",role:"alert",children:[s.jsx("p",{className:"font-bold",children:t("unacknowledgedMandatory")}),s.jsx("p",{children:`${p.length}${t("unacknowledgedCount")}`})]}),s.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6 space-y-4",children:s.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[s.jsxs("select",{value:i,onChange:e=>N(e.target.value),className:"border rounded p-2 text-sm",children:[s.jsx("option",{value:"ALL",children:t("allCategories")}),Object.entries(R).map(([e,a])=>s.jsx("option",{value:e,children:c?a.jp:a.en},e))]}),s.jsxs("select",{value:d,onChange:e=>k(e.target.value),className:"border rounded p-2 text-sm",children:[s.jsx("option",{value:"ALL",children:t("allImportances")}),Object.entries(f).map(([e,a])=>s.jsx("option",{value:e,children:t(a.key)},e))]}),s.jsxs("label",{className:"flex items-center text-sm",children:[s.jsx("input",{type:"checkbox",checked:x,onChange:e=>C(e.target.checked),className:"h-4 w-4 mr-2"}),t("showUnacknowledgedOnly")]})]})}),s.jsx("div",{className:"space-y-2",children:A.map(e=>{const a=e.acknowledgedBy.some(E=>E.userId===n.id),S=e.importance===o.Mandatory&&!a,b=f[e.importance];return s.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[s.jsxs("button",{onClick:()=>M(e.id),className:"w-full flex items-center justify-between p-4 text-left bg-gray-50 hover:bg-gray-100",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[S&&s.jsx("span",{className:"text-red-500",title:t("ackRequired"),children:"●"}),s.jsxs("span",{className:"font-bold",children:[e.ruleNumber,": ",c?e.titleJP:e.titleEN]})]}),s.jsx("p",{className:"text-sm text-gray-600",children:c?e.descriptionJP:e.descriptionEN})]}),s.jsxs("div",{className:"flex items-center gap-4 ml-4",children:[s.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${b.color}`,children:t(b.key)}),s.jsx($,{className:j===e.id?"transform rotate-180":""})]})]}),j===e.id&&s.jsxs("div",{className:"p-4 bg-white",children:[s.jsx("div",{className:"prose max-w-none",children:s.jsx(U,{markdown:e.details??""})}),e.importance===o.Mandatory&&s.jsx("div",{className:"mt-4 pt-4 border-t",children:a?s.jsx("div",{className:"text-green-600 font-medium text-sm",children:t("acknowledged")}):s.jsx("button",{onClick:()=>L(e.id),className:"bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700",children:t("acknowledgeRule")})})]})]},e.id)})})]}):null};export{B as default};
