import{u as z,e as G,k as H,f as J,r as l,j as t}from"./index-B-QOVXil.js";import{j as K}from"./App-gCA-TVeX.js";import{M as Q}from"./MarkdownRenderer-DbuJuX1V.js";const U=()=>{const{currentUser:d}=z(),{t:s}=G(),{projects:j,labNotebookEntries:m}=H(),{addLabNotebookEntry:S,updateLabNotebookEntry:C,deleteLabNotebookEntry:k}=K(),{showToast:c}=J(),[x,u]=l.useState(null),[E,n]=l.useState(!1),[h,I]=l.useState(""),[p,L]=l.useState(""),b=l.useMemo(()=>j.filter(e=>e.companyId===(d==null?void 0:d.companyId)),[j,d]),T=l.useMemo(()=>(m||[]).filter(e=>e.userId===(d==null?void 0:d.id)).filter(e=>p?new Date(e.experimentDate).toISOString().startsWith(p):!0).filter(e=>{const o=h.toLowerCase();return e.title.toLowerCase().includes(o)||e.content.toLowerCase().includes(o)||e.tags.some(r=>r.toLowerCase().includes(o))}).sort((e,o)=>new Date(o.experimentDate).getTime()-new Date(e.experimentDate).getTime()),[m,d,p,h]),i=l.useMemo(()=>x&&(m||[]).find(e=>e.id===x)||null,[x,m]),A=()=>{u(null),n(!0)},M=e=>{u(e),n(!1)},F=async()=>{i&&window.confirm(s("deleteEntryConfirm"))&&((await k(i.id)).success?(c(s("entryDeleted"),"success"),u(null),n(!1)):c(s("deleteFailed"),"error"))},P=({entry:e})=>{var N;const[o,r]=l.useState((e==null?void 0:e.title)||""),[f,O]=l.useState(e!=null&&e.experimentDate?new Date(e.experimentDate).toISOString().split("T")[0]:new Date().toISOString().split("T")[0]),[g,R]=l.useState((e==null?void 0:e.projectId)||""),[v,q]=l.useState(((N=e==null?void 0:e.tags)==null?void 0:N.join(", "))||""),[w,W]=l.useState((e==null?void 0:e.content)||""),[B,X]=l.useState((e==null?void 0:e.attachments)||[]),V=async()=>{if(!o){c(s("titleRequired"),"error");return}const a={title:o,experimentDate:new Date(f),projectId:g||void 0,tags:v.split(",").map($=>$.trim()).filter(Boolean),content:w,attachments:B,relatedEquipment:[],relatedSamples:[]},D=e!=null&&e.id?await C({...a,id:e.id,userId:e.userId,createdAt:e.createdAt,updatedAt:new Date}):await S(a);D.success?(c(s("saveSuccess"),"success"),u(D.data.id),n(!1)):c(s("saveFailed"),"error")};return t.jsxs("div",{className:"p-4 sm:p-6 space-y-4",children:[t.jsx("input",{type:"text",placeholder:s("entryTitle"),value:o,onChange:a=>r(a.target.value),className:"w-full text-2xl font-bold border-b-2 pb-2 focus:outline-none focus:border-ever-blue"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500",children:s("experimentDate")}),t.jsx("input",{type:"date",value:f,onChange:a=>O(a.target.value),className:"mt-1 w-full border rounded-md p-2"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500",children:s("relatedProject")}),t.jsxs("select",{value:g,onChange:a=>R(a.target.value),className:"mt-1 w-full border rounded-md p-2",children:[t.jsx("option",{value:"",children:s("none")}),b.map(a=>t.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500",children:s("tagsCommaSeparated")}),t.jsx("input",{type:"text",value:v,onChange:a=>q(a.target.value),className:"mt-1 w-full border rounded-md p-2"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500",children:s("contentMarkdown")}),t.jsx("textarea",{value:w,onChange:a=>W(a.target.value),rows:15,className:"mt-1 w-full border rounded-md p-2 font-mono text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-500",children:s("attachments")}),t.jsx("div",{className:"mt-1 p-2 border rounded-md bg-gray-50 text-center",children:t.jsx("p",{className:"text-sm text-gray-500",children:s("fileAttachmentWip")})})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{onClick:()=>n(!1),className:"px-4 py-2 border rounded-md",children:s("cancel")}),t.jsx("button",{onClick:V,className:"px-4 py-2 bg-ever-blue text-white rounded-md",children:s("save")})]})]})},y=({entry:e})=>{const o=e.projectId?b.find(r=>r.id===e.projectId):null;return t.jsxs("div",{className:"p-4 sm:p-6",children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:e.title}),t.jsxs("p",{className:"text-sm text-gray-500",children:[s("experimentDate"),": ",new Date(e.experimentDate).toLocaleDateString()]}),o&&t.jsxs("p",{className:"text-sm text-gray-500",children:[s("projectLabel"),": ",o.name]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>n(!0),className:"px-3 py-1 border rounded-md text-sm",children:s("edit")}),t.jsx("button",{onClick:F,className:"px-3 py-1 bg-red-500 text-white rounded-md text-sm",children:s("delete")})]})]}),e.tags.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:e.tags.map(r=>t.jsx("span",{className:"px-2 py-1 bg-gray-200 text-gray-700 text-xs rounded-full",children:r},r))}),t.jsx("div",{className:"prose max-w-none",children:t.jsx(Q,{markdown:e.content})})]})};return t.jsxs("div",{children:[t.jsx("h2",{className:"text-3xl font-bold mb-6 text-ever-black",children:s("electronicLabNotebook")}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-6 h-[calc(100vh-12rem)]",children:[t.jsxs("div",{className:"w-full md:w-1/3 bg-white rounded-lg shadow-md flex flex-col",children:[t.jsxs("div",{className:"p-4 border-b",children:[t.jsxs("div",{className:"flex gap-2 mb-2",children:[t.jsx("input",{type:"text",placeholder:s("search"),value:h,onChange:e=>I(e.target.value),className:"w-full border rounded-md p-2 text-sm"}),t.jsx("input",{type:"date",value:p,onChange:e=>L(e.target.value),className:"border rounded-md p-2 text-sm"})]}),t.jsx("button",{onClick:A,className:"w-full bg-ever-blue text-white font-bold py-2 px-4 rounded-lg text-sm",children:s("newEntry")})]}),t.jsx("div",{className:"overflow-y-auto",children:T.map(e=>t.jsxs("div",{onClick:()=>M(e.id),className:`p-4 border-b cursor-pointer hover:bg-gray-50 ${x===e.id?"bg-ever-blue-light":""}`,children:[t.jsx("h4",{className:"font-semibold truncate",children:e.title}),t.jsx("p",{className:"text-sm text-gray-500",children:new Date(e.experimentDate).toLocaleDateString()})]},e.id))})]}),t.jsx("div",{className:"w-full md:w-2/3 bg-white rounded-lg shadow-md overflow-y-auto",children:E?t.jsx(P,{entry:i}):i?t.jsx(y,{entry:i}):t.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:t.jsx("p",{children:s("selectOrCreateEntry")})})})]})]})};export{U as default};
