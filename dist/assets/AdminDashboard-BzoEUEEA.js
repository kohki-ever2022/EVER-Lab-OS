import{u as T,e as w,t as F,S as L,$ as B,o as J,v as U,d as Y,f as $,r,E as z,w as O,p as G,j as e,R as H}from"./index-B-QOVXil.js";import{a as K,k as Q,l as V,C as W,M as X,E as Z,m as _}from"./App-gCA-TVeX.js";const u=({title:a,value:t,icon:c})=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow flex items-center",children:[e.jsx("div",{className:"p-3 bg-lab-blue-light/20 rounded-full mr-4",children:c}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:a}),e.jsx("p",{className:"text-2xl font-bold text-lab-text",children:t})]})]}),ee=({title:a,results:t,onClose:c})=>{const{t:d}=w();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-lg",children:[e.jsx("h4",{className:"text-lg font-bold text-ever-black mb-4",children:a}),e.jsx("div",{className:"max-h-60 overflow-y-auto bg-gray-50 p-3 rounded-md text-sm space-y-2",children:t.length>0?t.map((h,g)=>e.jsx("p",{className:"text-gray-700",children:h},g)):e.jsx("p",{className:"text-gray-500",children:d("noItemsToProcess")})}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:c,className:"bg-lab-blue text-white font-bold py-2 px-4 rounded-lg",children:d("close")})})]})})},ne=()=>{const{currentUser:a}=T(),{t,isJapanese:c}=w(),{memos:d}=F(),h=L(),g=B(),p=J(),m=U(),y=Y(),{showToast:x}=$(),{hasPermission:v}=K(),{emergencyStopAllEquipment:N}=Q(),[b,C]=r.useState(null),S=r.useMemo(()=>m.filter(s=>s.status===z.Maintenance).length,[m]),k=r.useMemo(()=>{const s=new Date,o=new Date(s.getFullYear(),s.getMonth(),s.getDate()),i=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1);return p.filter(n=>{const l=new Date(n.startTime);return l>=o&&l<i}).length},[p]),M=r.useMemo(()=>d.filter(s=>s.recipientId===(a==null?void 0:a.id)&&!s.isRead).length,[d,a]),j=r.useMemo(()=>g.filter(s=>s.status===O.Reported),[g]),R=r.useMemo(()=>p.filter(s=>s.status===G.CheckedIn),[p]),D=()=>{x(t("noShowProcessed"),"success")},E=()=>{x(t("autoCheckoutProcessed"),"success")},I=()=>{x(t("remindersSent"),"success")},A=async()=>{if(window.confirm(t("emergencyStopConfirm"))&&N){const s=await N();s.success===!1?x(t("emergencyStopFailed")+`: ${s.error.message}`,"error"):x(t("emergencyStopSuccess"),"info")}},P=r.useMemo(()=>{const s=new Date;s.setDate(s.getDate()-30);const i=h.filter(n=>new Date(n.date).getTime()>=s.getTime()).reduce((n,l)=>(n[l.equipmentId]=(n[l.equipmentId]||0)+l.durationMinutes,n),{});return Object.entries(i).sort(([,n],[,l])=>Number(l)-Number(n)).slice(0,5).map(([n,l])=>{const f=m.find(q=>q.id===n);return{name:f?c?f.nameJP:f.nameEN:"Unknown",hours:(Number(l)/60).toFixed(1)}})},[h,m,c]);return e.jsxs("div",{children:[b&&e.jsx(ee,{title:b.title,results:b.results,onClose:()=>C(null)}),e.jsx("h2",{className:"text-3xl font-bold mb-6 text-ever-black",children:t("adminDashboard")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[e.jsx(u,{title:t("activeReservations"),value:R.length,icon:e.jsx(V,{className:"h-6 w-6 text-ever-blue"})}),e.jsx(u,{title:t("todaysBookings"),value:k,icon:e.jsx(W,{className:"h-6 w-6 text-ever-blue"})}),e.jsx(u,{title:t("unreadMemos"),value:M,icon:e.jsx(X,{className:"h-6 w-6 text-ever-blue"})}),e.jsx(u,{title:t("malfunctionReports"),value:j.length,icon:e.jsx(Z,{className:"h-6 w-6 text-ever-blue"})}),e.jsx(u,{title:t("inMaintenance"),value:S,icon:e.jsx(_,{className:"h-6 w-6 text-ever-blue"})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-ever-black mb-4",children:t("adminActions")}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[v("system","configureSettings")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:D,className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg text-sm",children:t("processNoShows")}),e.jsx("button",{onClick:E,className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg text-sm",children:t("processAutoCheckouts")}),e.jsx("button",{onClick:I,className:"bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg text-sm",children:t("sendReminders")})]}),(a==null?void 0:a.role)===H.FacilityDirector&&e.jsx("button",{onClick:A,className:"bg-gradient-to-r from-red-600 to-red-700 text-white hover:from-red-500 hover:to-red-600 font-bold py-2 px-4 rounded-lg text-sm",children:t("emergencyStopAll")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:t("usageRanking30d")}),e.jsx("ul",{className:"space-y-3",children:P.map((s,o)=>e.jsxs("li",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:s.name}),e.jsxs("span",{className:"font-semibold text-gray-600",children:[s.hours,"h"]})]},o))})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:t("reportsRequiringAction")}),e.jsxs("ul",{className:"space-y-3",children:[j.map(s=>{const o=m.find(n=>n.id===s.equipmentId),i=y.find(n=>n.id===s.reportedByUserId);return e.jsxs("li",{className:"p-3 bg-yellow-50 rounded-md",children:[e.jsx("p",{className:"font-semibold text-yellow-800",children:c?o==null?void 0:o.nameJP:o==null?void 0:o.nameEN}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:s.notes}),e.jsxs("p",{className:"text-xs text-yellow-600 mt-2",children:[t("by")," ",i==null?void 0:i.name," - ",new Date(s.reportDate).toLocaleDateString()]})]},s.id)}),j.length===0&&e.jsx("p",{className:"text-sm text-gray-500",children:t("noReports")})]})]})]})]})};export{ne as default};
