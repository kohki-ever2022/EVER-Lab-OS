import{u as w,e as C,m as M,r as o,a0 as h,j as t,a1 as a}from"./index-B-QOVXil.js";import{M as k}from"./MarkdownRenderer-DbuJuX1V.js";import{a as S}from"./App-gCA-TVeX.js";const A=()=>{const{currentUser:u,isFacilityStaff:i}=w(),{t:l,isJapanese:n}=C(),{manuals:g}=M(),{hasPermission:p}=S(),[m,j]=o.useState("ALL"),[d,N]=o.useState(""),[s,x]=o.useState(null),v=p("manuals","read"),y=o.useMemo(()=>u?g.filter(e=>{var r;if(!e.isPublished&&!i)return!1;switch(e.targetAudience){case h.AllUsers:return!0;case h.Tenants:return u.roleCategory==="TENANT"||i;case h.FacilityStaff:return i;case h.SpecificRoles:return((r=e.specificRoles)==null?void 0:r.includes(u.role))||i;default:return i}}):[],[g,u,i]),c=o.useMemo(()=>y.filter(e=>{const r=m==="ALL"||e.category===m,b=d===""||(n?e.titleJP:e.titleEN).toLowerCase().includes(d.toLowerCase())||(n?e.descriptionJP:e.descriptionEN).toLowerCase().includes(d.toLowerCase());return r&&b}).sort((e,r)=>n?e.titleJP.localeCompare(r.titleJP):e.titleEN.localeCompare(r.titleEN)),[y,m,d,n]);if(o.useEffect(()=>{c.length>0&&!s?x(c[0]):s&&!c.find(e=>e.id===s.id)&&x(c.length>0?c[0]:null)},[c,s]),!v)return t.jsx("div",{children:l("permissionDenied")});const f={[a.GettingStarted]:{key:"categoryGettingStarted"},[a.EquipmentOperation]:{key:"categoryEquipment"},[a.SafetyProcedures]:{key:"categorySafety"},[a.EmergencyResponse]:{key:"categoryEmergency"},[a.Compliance]:{key:"categoryCompliance"},[a.DataManagement]:{key:"categoryData"},[a.Maintenance]:{key:"categoryMaintenance"},[a.TenantGuide]:{key:"categoryTenant"},[a.FacilityStaffGuide]:{key:"categoryFacility"},[a.FAQ]:{key:"categoryFAQ"},[a.Other]:{key:"categoryOther"}};return t.jsxs("div",{children:[t.jsx("h2",{className:"text-3xl font-bold mb-6 text-ever-black",children:l("manuals")}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-6 h-[calc(100vh-12rem)]",children:[t.jsxs("div",{className:"w-full md:w-1/3 bg-white rounded-lg shadow-md flex flex-col",children:[t.jsxs("div",{className:"p-4 border-b",children:[t.jsx("input",{type:"text",placeholder:l("search"),value:d,onChange:e=>N(e.target.value),className:"w-full border rounded-md p-2 text-sm mb-2"}),t.jsxs("select",{value:m,onChange:e=>j(e.target.value),className:"w-full border rounded-md p-2 text-sm",children:[t.jsx("option",{value:"ALL",children:l("allCategories")}),Object.entries(f).map(([e,{key:r}])=>t.jsx("option",{value:e,children:l(r)},e))]})]}),t.jsx("div",{className:"overflow-y-auto",children:c.map(e=>t.jsxs("div",{onClick:()=>x(e),className:`p-4 border-b cursor-pointer hover:bg-gray-50 ${(s==null?void 0:s.id)===e.id?"bg-ever-blue-light":""}`,children:[t.jsx("h4",{className:"font-semibold truncate",children:n?e.titleJP:e.titleEN}),t.jsx("p",{className:"text-sm text-gray-500",children:l(f[e.category].key)})]},e.id))})]}),t.jsx("div",{className:"w-full md:w-2/3 bg-white rounded-lg shadow-md overflow-y-auto",children:s?t.jsxs("div",{className:"p-6",children:[t.jsx("h3",{className:"text-2xl font-bold mb-2",children:n?s.titleJP:s.titleEN}),t.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:[l("lastUpdated")," ",new Date(s.updatedAt).toLocaleDateString()]}),t.jsx("div",{className:"prose max-w-none",children:t.jsx(k,{markdown:n?s.contentJP:s.contentEN})})]}):t.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:t.jsx("p",{children:l("selectManual")})})})]})]})};export{A as default};
