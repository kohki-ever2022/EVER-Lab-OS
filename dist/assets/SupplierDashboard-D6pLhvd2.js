import{X as w,u as E,r as l,Y as S,e as C,f as T,j as e}from"./index-B-QOVXil.js";const F=()=>{const{setQuotations:r}=w(),{currentUser:t}=E(),u=l.useCallback(async(h,m)=>t?(r(o=>o.map(d=>d.id===h?{...d,responses:[...d.responses,{...m,supplierId:t.id,answeredAt:new Date}],status:S.Answered}:d)),{success:!0,data:void 0}):{success:!1,error:new Error("Not logged in")},[t,r]);return l.useMemo(()=>({addQuotationResponseFromSupplier:u}),[u])},O=()=>{const{currentUser:r}=E(),{t}=C(),{quotations:u}=w(),{addQuotationResponseFromSupplier:h}=F(),{showToast:m}=T(),[o,d]=l.useState("PENDING"),[x,R]=l.useState({}),c=l.useMemo(()=>u.filter(a=>a.supplierIds.includes((r==null?void 0:r.id)||"")),[u,r]),v=l.useMemo(()=>c.filter(a=>a.status==="REQUESTED"&&!a.responses.some(s=>s.supplierId===(r==null?void 0:r.id))),[c,r]),N=l.useMemo(()=>c.filter(a=>a.responses.some(s=>s.supplierId===(r==null?void 0:r.id))),[c,r]),y=l.useMemo(()=>c.filter(a=>a.status==="ORDERED"),[c]),b=(a,s,n)=>{R(p=>({...p,[a]:{...p[a],[s]:n}}))},Q=async a=>{const s=x[a];if(!s||!s.price||!s.deliveryDate){m(t("priceAndDateRequired"),"error");return}(await h(a,{price:parseFloat(s.price),deliveryDate:new Date(s.deliveryDate),notes:s.notes})).success===!1?m(t("responseSubmitFailed"),"error"):m(t("responseSubmitted"),"success")},g=a=>a.length===0?e.jsx("p",{className:"text-gray-500 py-8 text-center",children:t("noRequestsFound")}):e.jsx("div",{className:"space-y-4",children:a.map(s=>{var p,D,j,f;const n=s.responses.find(i=>i.supplierId===(r==null?void 0:r.id));return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[e.jsx("h4",{className:"font-bold",children:s.productName}),e.jsx("p",{className:"text-sm text-gray-600",children:s.productDetails}),e.jsxs("p",{className:"text-sm mt-2",children:[t("quantity")," ",s.quantity]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t("requestedOn")," ",new Date(s.requestDate).toLocaleDateString()]}),o==="PENDING"&&!n&&e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium",children:t("priceYen")}),e.jsx("input",{type:"number",value:((p=x[s.id])==null?void 0:p.price)||"",onChange:i=>b(s.id,"price",i.target.value),className:"w-full border rounded p-1 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium",children:t("deliveryDate")}),e.jsx("input",{type:"date",value:((D=x[s.id])==null?void 0:D.deliveryDate)||"",onChange:i=>b(s.id,"deliveryDate",i.target.value),className:"w-full border rounded p-1 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium",children:t("notes")}),e.jsx("textarea",{value:((j=x[s.id])==null?void 0:j.notes)||"",onChange:i=>b(s.id,"notes",i.target.value),className:"w-full border rounded p-1 text-sm",rows:2})]}),e.jsx("button",{onClick:()=>Q(s.id),className:"bg-blue-600 text-white px-3 py-1 text-sm rounded hover:bg-blue-700",children:t("respond")})]}),n&&e.jsxs("div",{className:"mt-3 pt-3 border-t bg-gray-50 p-3 rounded",children:[e.jsx("h5",{className:"text-sm font-semibold",children:t("yourResponse")}),e.jsxs("p",{className:"text-sm",children:[t("price"),": Â¥",(f=n.price)==null?void 0:f.toLocaleString()]}),e.jsxs("p",{className:"text-sm",children:[t("deliveryDate"),": ",n.deliveryDate?new Date(n.deliveryDate).toLocaleDateString():"N/A"]}),n.notes&&e.jsxs("p",{className:"text-sm mt-1 text-gray-600",children:[t("notes"),": ",n.notes]})]})]},s.id)})});return e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 text-ever-black",children:t("supplierDashboard")}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:t("quotationManagement")}),e.jsx("div",{className:"border-b border-gray-200 mb-4",children:e.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>d("PENDING"),className:`${o==="PENDING"?"border-ever-blue text-ever-blue":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:[t("pending")," (",v.length,")"]}),e.jsxs("button",{onClick:()=>d("QUOTED"),className:`${o==="QUOTED"?"border-ever-blue text-ever-blue":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:[t("quoted")," (",N.length,")"]}),e.jsxs("button",{onClick:()=>d("ORDERED"),className:`${o==="ORDERED"?"border-ever-blue text-ever-blue":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:[t("ordered")," (",y.length,")"]})]})}),o==="PENDING"&&g(v),o==="QUOTED"&&g(N),o==="ORDERED"&&g(y)]}),e.jsxs("div",{className:"mt-8 bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:t("deliveryManagement")}),e.jsx("p",{className:"text-gray-500",children:t("noItemsForDelivery")})]})]})};export{O as default};
